{% extends 'base.html' %} {% block content %}

<body>
  <div class="bg-top bg-no-repeat bg-cover min-h-[50vh]">
    <style>
      .banner-top {
        background-repeat: no-repeat;

        background-size: cover;

        background-position: top center;

        background-attachment: local;
      }
    </style>

    <!-- main section -->
    <div class="flex md:flex-row flex-col">
      <div class="flex flex-col px-6 my-6 md:pl-24 md:pr-6 w-[100%] md:w-[30%]">
        <!-- top part -->
        <div class="w-full flex flex-col">
            <!-- search -->
        <form
          method="get"
          action="{% url 'index' %}"
          class=" h-10 bg-[#EDE7F0] rounded-[28px] flex items-center"
        >
          <input
            id="search-input"
            type="search"
            placeholder="Search Template"
            class="w-full focus:outline-none border-none bg-transparent ml-2"
            autocomplete="off"
          />

          <!-- Your SVG icon here -->
          <svg
            width="48"
            height="48"
            viewBox="0 0 48 48"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <g clip-path="url(#clip0_1341_608)">
              <path
                d="M31.6 33L25.3 26.7C24.8 27.1 24.225 27.4167 23.575 27.65C22.925 27.8833 22.2333 28 21.5 28C19.6833 28 18.1458 27.3708 16.8875 26.1125C15.6292 24.8542 15 23.3167 15 21.5C15 19.6833 15.6292 18.1458 16.8875 16.8875C18.1458 15.6292 19.6833 15 21.5 15C23.3167 15 24.8542 15.6292 26.1125 16.8875C27.3708 18.1458 28 19.6833 28 21.5C28 22.2333 27.8833 22.925 27.65 23.575C27.4167 24.225 27.1 24.8 26.7 25.3L33 31.6L31.6 33ZM21.5 26C22.75 26 23.8125 25.5625 24.6875 24.6875C25.5625 23.8125 26 22.75 26 21.5C26 20.25 25.5625 19.1875 24.6875 18.3125C23.8125 17.4375 22.75 17 21.5 17C20.25 17 19.1875 17.4375 18.3125 18.3125C17.4375 19.1875 17 20.25 17 21.5C17 22.75 17.4375 23.8125 18.3125 24.6875C19.1875 25.5625 20.25 26 21.5 26Z"
                fill="#49454F"
              />
            </g>
            <defs>
              <clipPath id="clip0_1341_608">
                <rect x="4" y="4" width="40" height="40" rx="20" fill="white" />
              </clipPath>
            </defs>
          </svg>
        </form>

        <!-- search end -->
          <!-- Selector -->
          <div class="md:hidden relative w-[50%] mt-5">
            <!-- Dropdown Button -->
            <div
              id="mobileDropdownButton"
              class="w-full border-2 border-[#808080] rounded-[20px] text-black text-[14px] font-bold px-4 py-2 bg-white cursor-pointer"
            >
              All Templates
            </div>
            <!-- Dropdown Menu -->
            <div
              id="mobileDropdownMenu"
              class="hidden absolute w-full bg-white mt-2 z-10"
            >
              <div class="dropdown-item px-4 py-2 cursor-pointer">All</div>
              <div
                class="dropdown-item px-4 py-2 cursor-pointer"
                data="sustainability-report"
              >
                SR Templates
              </div>
              <div
                class="dropdown-item px-4 py-2 cursor-pointer"
                data="annual-report"
              >
                AR / QR Templates
              </div>
            </div>
          </div>

          <div
            class="hidden md:flex flex-col md:flex-row space-y-2 md:space-y-0 mb-5 md:mb-0 md:mt-5 space-x-3"
          >
            <button
              id="button1"
              class="filter-btn button bg-white border-2 border-[#808080] rounded-[20px] text-black text-[11px] font-bold px-2 py-0 md:py-0 transition-colors duration-100 md:h-[36px] min-w-20"
              style="background-color: rgb(139, 240, 129)"
            >
              All
            </button>
            <button
              id="button2"
              class="filter-btn button bg-white border-2 border-[#808080] rounded-[20px] text-black text-[11px] font-bold px-2 py-0 md:py-0 transition-colors duration-100 md:h-[36px] min-w-20"
              data="sustainability-report"
            >
              SR
            </button>
            <button
              id="button3"
              class="filter-btn button bg-white border-2 border-[#808080] rounded-[20px] text-black text-[11px] font-bold px-2 py-0 md:py-0 transition-colors duration-100 md:h-[36px] min-w-20"
              data="annual-report"
            >
              AR / QR
            </button>
          </div>

          <script>
            document.addEventListener("DOMContentLoaded", () => {
              // Desktop buttons
              const buttons = document.querySelectorAll(".filter-btn");
              const clearHighlight = () => {
                buttons.forEach((button) => {
                  button.style.backgroundColor = "white";
                  button.style.color = "black";
                });
              };

              buttons.forEach((button) => {
                button.addEventListener("click", () => {
                  clearHighlight();
                  button.style.backgroundColor = "rgb(139, 240, 129)";
                  button.style.color = "black";
                });
              });

              const defaultButton = document.getElementById("button1");
              if (defaultButton) {
                defaultButton.style.backgroundColor = "rgb(139, 240, 129)";
                defaultButton.style.color = "black";
              }

              // Mobile dropdown
              const dropdownButton = document.getElementById(
                "mobileDropdownButton"
              );
              const dropdownMenu =
                document.getElementById("mobileDropdownMenu");
              const dropdownItems = document.querySelectorAll(".dropdown-item");

              dropdownButton.addEventListener("click", () => {
                dropdownMenu.classList.toggle("hidden");
              });

              dropdownItems.forEach((item) => {
                item.addEventListener("click", () => {
                  dropdownItems.forEach((i) => {
                    i.style.backgroundColor = "white";
                    i.style.color = "black";
                  });

                  item.style.backgroundColor = "rgb(139, 240, 129)";
                  item.style.color = "black";

                  dropdownButton.textContent = item.textContent;

                  dropdownMenu.classList.add("hidden");
                });
              });

              document.addEventListener("click", (e) => {
                if (
                  !dropdownMenu.contains(e.target) &&
                  e.target !== dropdownButton
                ) {
                  dropdownMenu.classList.add("hidden");
                }
              });
            });
          </script>

          <!-- selector end -->
        </div>
        <!-- top part end -->
        <!-- grid -->
        <div class="grid grid-cols-2 gap-4 mt-5 overflow-auto">
          <style>
            .selected {
              border-color: #dc4955;
              border-width: 5px;
              border-radius: 9px;
            }
          </style>

          {% for template in templates %}
          <!-- one item -->
<div
  class="flex flex-col w-full md:max-w-[341px] aspect-[341/529] transition-transform duration-200 ease-in-out hover:scale-[98%]"
  data-template-name="{{ template.name }}"
>

          <button
            class="selection-btn"
            data-name="{{ template.name }}"
            data-id="{{ template.id }}"
            data-thumbnail="{{ template.cover_part.thumbnail.url }}"
            {% if selected_id and template.id|stringformat:"s" == selected_id %}
              data-selected="true"
            {% endif %}
          >
          
              <div class="font-bold w-full h-full">
                <img
                  src="{{ template.cover_part.thumbnail.url }}"
                  alt="Thumbnail for {{ template.name }}"
                  class="w-full h-auto rounded shadow "
                />
              </div>
            </button>

            <div
              class="flex w-full items-center mt-2 text-[16px] text-black text-center justify-center"
            >
              {{ template.name }}
            </div>
          </div>
          {% endfor %}
        </div>
        <!-- grid end -->
      </div>
      <div class="bg-[#2A2A2A] flex md:flex-row flex-col min-h-screen flex-1">
        <!-- back to gallery mobile -->
        <div class="md:hidden flex my-5 mx-5">
          <a href="{% url 'index' %}" class="flex justify-center items-center">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M7.825 13L13.425 18.6L12 20L4 12L12 4L13.425 5.4L7.825 11H20V13H7.825Z"
                fill="#FEF7FF"
              />
            </svg>
            <div class="text-white ml-2">Back To Gallery</div>
          </a>
        </div>
        <!--  -->
        <!-- main image -->
        <div
          class="flex md:ml-8 md:my-5 mx-4 relative md:justify-start justify-center"
        >
          <div
            class="md:h-[calc(100vh-100px)] h-[calc(100vh-360px)] flex relative"
          >
            <img
              id="selected-template-image"
              src=""
              alt="Template Image"
              class="h-full w-auto object-contain rounded-[10px] hidden"
            />
          </div>
        </div>
        <!--  -->
        <div
          class="mt-4 mb-6 md:my-8 flex flex-col w-auto flex-1 md:ml-5 md:mr-[10%] mx-5"
        >
          <!-- back to gallery  desktop -->
          <div class="md:flex hidden">
            <a
              href="{% url 'index' %}"
              class="flex justify-center items-center"
            >
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M7.825 13L13.425 18.6L12 20L4 12L12 4L13.425 5.4L7.825 11H20V13H7.825Z"
                  fill="#FEF7FF"
                />
              </svg>
              <div class="text-white ml-2">Back To Gallery</div>
            </a>
          </div>
          <!--  -->
          <div id="template-preview">
            <!-- default empty -->
            <div
              class="text-white font-bold text-[28px] md:mt-4 md:text-start text-center"
              id="selected-template-name"
            >
              Select a template
            </div>

            <a
            id="use-template-btn"
            href="{% if selected_id %}{% url 'create_user_document' template_id=selected_id %}{% else %}#{% endif %}"
            class="mt-4 flex justify-center items-center bg-orange-400 text-white font-bold px-5 py-3 rounded-[5px] hover:bg-orange-600 transition-all duration-400 ease-in-out {% if not selected_id %}hidden{% endif %}"
          >
            Use template
          </a>
          
          </div>

         <div class="mt-8 md:mt-14 text-white flex  items-center "> <span class="mr-auto" >Template Parts</span>
<a href="#" id="add-parts-btn" class="bg-gray-700 text-white px-2 py-0 rounded-lg hover:bg-gray-600 transition inline-flex items-center justify-center" aria-label="Add Template Part">+</a>
          </div>
         
          <div class="mt-2 grid grid-cols-3 grid-rows-2 gap-x-2 gap-y-3">
            {% for part in template.parts.all %}
            <div class="block group relative">
              <div>
                <img
                  src="{{ part.thumbnail.url }}"
                  alt="{{ part.name }}"
                  class="h-full w-full object-cover rounded-[10px] "
                />
                <!-- Hover text -->
                <div class="absolute inset-0 flex items-center justify-center rounded-[10px] 
                bg-black/0 group-hover:bg-black/80 
                transition-colors duration-200 ease-in-out">
                 <p class="text-white font-semibold text-sm opacity-0 group-hover:opacity-100 
                transition-opacity duration-200 ease-in-out text-center">
        {{ part.name }}
      </p>
    </div>
              </div>
            </div>
            {% endfor %}
          </div>
          
        </div>
      </div>
    </div>

    <!-- main section end -->
    <!-- main stuff -->

    <!-- main stuff end-->
  </div>

<!-- <a id="add-parts-btn" href="#" class=" btn btn-secondary ml-2">boboboboobob</a> -->


  <!-- scripts -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const searchInput = document.getElementById("search-input");
  const templateGrid = document.querySelector(".grid.grid-cols-2"); // Adjust selector if needed
  const templates = Array.from(templateGrid.querySelectorAll("div[data-template-name]"));

  // Debounce helper function
  function debounce(func, wait) {
    let timeout;
    return function (...args) {
      clearTimeout(timeout);
      timeout = setTimeout(() => func.apply(this, args), wait);
    };
  }

  function filterTemplates() {
    const query = searchInput.value.trim().toLowerCase();
    templates.forEach((templateDiv) => {
      const name = templateDiv.getAttribute("data-template-name").toLowerCase();
      if (name.includes(query)) {
        templateDiv.style.display = "";
      } else {
        templateDiv.style.display = "none";
      }
    });
  }

  const debouncedFilter = debounce(filterTemplates, 300);

  // Live filter on input
  searchInput.addEventListener("input", debouncedFilter);

  // Optional: pressing Enter triggers immediate filter and prevents default form submit
  searchInput.addEventListener("keydown", function (e) {
    if (e.key === "Enter") {
      e.preventDefault();
      filterTemplates();
    }
  });
});
</script>

  
  <!-- this is to update from left side to right side -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const buttons = document.querySelectorAll(".selection-btn");
      const nameField = document.getElementById("selected-template-name");
      const useBtn = document.getElementById("use-template-btn");
      const previewImg = document.getElementById("selected-template-image");
      const addPartsBtn = document.getElementById("add-parts-btn");

      let selected = document.querySelector(
        '.selection-btn[data-selected="true"]'
      );
      if (!selected && buttons.length > 0) {
        selected = buttons[0]; // fallback
      }

      if (selected) {
        selected.querySelector("div").classList.add("selected");

        nameField.textContent = selected.dataset.name;
        // useBtn.href = `/edit/${selected.dataset.id}/`;
        // This one is for when the page loads with a selection
        useBtn.href = `/template/${selected.dataset.id}/create/`;
        useBtn.classList.remove("hidden");
        

        previewImg.src = selected.dataset.thumbnail;
        previewImg.alt = `Thumbnail for ${selected.dataset.name}`;
        previewImg.classList.remove("hidden");
        addPartsBtn.href = `/add-template-part/${selected.dataset.id}/`;
  addPartsBtn.classList.remove("hidden");
      }

      buttons.forEach((button) => {
        button.addEventListener("click", () => {
          const id = button.dataset.id;
          window.location.href = `?selected_id=${id}`;
          buttons.forEach((btn) => {
            
            btn.querySelector("div").classList.remove("selected");
            
          });

          button.querySelector("div").classList.add("selected");

          const name = button.dataset.name;
         
          const thumbnail = button.dataset.thumbnail;

          nameField.textContent = name;
          // useBtn.href = `/edit/${id}/`;
          // ... and this one is inside the click listener for other templates
          useBtn.href = `/template/${id}/create/`;
          useBtn.classList.remove("hidden");
          

          previewImg.src = thumbnail;
          previewImg.alt = `Thumbnail for ${name}`;
          previewImg.classList.remove("hidden");
           addPartsBtn.href = `/add-template-part/${button.dataset.id}/`;
    addPartsBtn.classList.remove("hidden");
        });
      });
    });
  </script>

  <!-- testing -->

  {% comment %} <h1>Template: {{ template.name }}</h1>
  <pre>{{ template|safe }}</pre>

  {% if template %}
  <p>{{ template.name }}</p>
  <a href="{% url 'edit_template' template.id %}">Edit</a>
  {% else %}
  <p>No template found.</p>
  {% endif %}


  <h1>{{ template.name }}</h1>

  {% for part in template.parts.all %}
  <div>
    <p>{{ part.name }}</p>
    <img src="{{ part.thumbnail.url }}" width="200" />
    <a href="{% url 'edit_template_part' part.id %}"></a>
  </div>
  {% endfor %}
<p>balls balls balls balls</p>
  <p>{{ template }}</p>
<p>{{ template.parts.all }}</p>


  {% for template in templates %}
  <div>
    <h3>{{ template.name }}</h3>
    <a href="{% url 'edit_template' template.id %}">
      <img
        src="{{ template.thumbnail.url }}"
        alt="Thumbnail for {{ template.name }}"
        width="200"
      />
    </a>
  </div>
  {% endfor %} {% endcomment %}


  <!-- TESTING -->

</body>

{% endblock %}
